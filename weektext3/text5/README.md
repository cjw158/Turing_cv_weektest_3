# 题目5：综合项目 - 交通车辆检测与流量分析系统

## 项目背景

智能交通系统是现代城市管理的重要组成部分。本项目要求开发一个交通车辆检测与流量分析系统，通过计算机视觉技术对道路图像进行分析，实现车辆识别、计数和流量统计。这是一个真实的应用场景，在智慧城市、交通管理、停车场管理等领域有广泛应用。

## 提交要求
提交检测结果图像和分析报告及源代码

## 项目目标

开发一个智能交通分析系统，实现以下功能：
1. 自动检测和识别图像中的车辆
2. 统计车辆数量和分布密度
3. 分析车辆大小特征（用于区分车型）
4. 生成可视化的交通流量分析报告
5. 为交通管理决策提供数据支持

## 任务要求

请开发一个完整的交通车辆检测与分析系统，实现以下功能：

### 第一阶段：图像采集与预处理
1. 读取交通场景图像 `traffic.jpg`（包含道路上的多辆车辆）
2. 图像预处理
   - 转换为灰度图
   - 高斯模糊降噪
3. 保存预处理后的图像用于对比

### 第二阶段：车辆检测与分割
4. 使用 Canny 边缘检测识别车辆边缘（基础边缘检测）
5. 使用形态学操作优化检测结果（基础形态学）：
   - 闭运算：连接车辆的断裂边缘
   - 开运算：去除道路标记等干扰
6. 使用轮廓检测提取车辆候选区域

### 第三阶段：车辆识别与特征提取
7. 过滤无效检测（使用基础的面积和长宽比判断）
8. 统计车辆总数
9. 使用 Numpy 基础操作提取每辆车的特征：
   - 计算车辆面积（用于区分车型大小）
   - 获取边界框尺寸
10. 在原图上标注每辆车（使用基础绘图函数）：
    - 绘制矩形边界框
    - 标注车辆编号
    - 根据车辆大小用不同颜色标识

### 第四阶段：交通流量数据分析
11. 使用 Numpy 基础函数进行数据统计：
    - 计算车辆总数
    - 计算车辆面积的统计值（最小值、最大值、平均值、标准差）
    - 计算道路的车辆密度（车辆数/图像面积）
12. 简单的车型分类（基于面积和平均值、标准差）：
    - 小型车：面积小于平均值
    - 大型车：面积大于平均值

### 第五阶段：可视化报告生成
13. 使用 Matplotlib 基础绘图创建分析报告（2×2 子图布局）：
    - 原始交通图像
    - 边缘检测结果
    - 车辆检测标注图
    - 车辆面积分布直方图
14. 添加标题、标签等基础标注

### 第六阶段：结果输出与报告
15. 保存标注后的检测结果图像：`traffic_detected.jpg`
16. 保存完整的分析报告：`traffic_analysis_report.png`
17. 生成文字版分析报告，包含：
    - 车辆总数统计
    - 不同车型的数量和占比
    - 道路拥堵程度评估
    - 流量分析建议

## 技术提示

### OpenCV 基础操作
- `cv2.imread()` - 读取图像
- `cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)` - 转换为灰度图
- `cv2.cvtColor(image, cv2.COLOR_BGR2RGB)` - BGR转RGB（用于matplotlib显示）
- `cv2.GaussianBlur(gray, (5, 5), 0)` - 高斯模糊降噪
- `cv2.Canny(blurred, 50, 150)` - Canny边缘检测
- `cv2.morphologyEx(edges, cv2.MORPH_CLOSE, kernel)` - 闭运算
- `cv2.morphologyEx(edges, cv2.MORPH_OPEN, kernel)` - 开运算
- `cv2.findContours()` - 查找轮廓
- `cv2.contourArea(contour)` - 计算轮廓面积
- `cv2.boundingRect(contour)` - 获取边界框坐标
- `cv2.rectangle()` - 绘制矩形框
- `cv2.putText()` - 添加文字
- `cv2.imwrite()` - 保存图像

### Numpy 基础统计
- `np.ones()` - 创建全1数组（用于形态学核）
- `np.array()` - 创建数组
- `np.mean(array)` - 计算平均值
- `np.std(array)` - 计算标准差
- `np.min(array)` - 最小值
- `np.max(array)` - 最大值
- 数组切片和条件过滤

### Matplotlib 基础绘图
- `plt.figure()` - 创建图形
- `plt.subplot(2, 2, 1)` - 创建子图（2×2布局）
- `plt.imshow()` - 显示图像
- `plt.hist()` - 绘制直方图
- `plt.title()` - 添加标题
- `plt.axis('off')` - 关闭坐标轴
- `plt.savefig()` - 保存图像


## 扩展方向（选做）

1. **车辆追踪**：如果有视频流，如何实现车辆的跨帧追踪？
2. **速度估算**：根据连续帧图像，如何估算车辆行驶速度？
3. **异常检测**：如何检测逆行、违停等异常交通行为？
4. **拥堵分析**：如何量化道路拥堵程度，提出交通优化建议？
5. **深度学习集成**：如何结合 YOLO 等深度学习模型提升检测精度？
